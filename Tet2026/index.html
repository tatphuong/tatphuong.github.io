<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tết 2026 - Pháo Hoa Rực Rỡ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@900&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }
        body { 
            /* Nền tối sâu để pháo hoa nổi bật */
            background: radial-gradient(circle at bottom center, #1a0505 0%, #000000 90%);
            overflow: hidden; font-family: 'Montserrat', sans-serif; 
            height: 100vh; width: 100vw; 
        }
        
        canvas { position: absolute; top: 0; left: 0; }
        
        /* === LAYER ORDER === */
        #fw-canvas { z-index: 1; }      
        #text-canvas { z-index: 2; pointer-events: none; }    
        #blossom-canvas { z-index: 3; pointer-events: none; opacity: 0; transition: opacity 2s; } 
        #tree-canvas { z-index: 4; pointer-events: none; opacity: 0; transition: opacity 3s ease-in-out; }
        #items-layer { z-index: 10; pointer-events: none; position: absolute; top:0; left:0; width:100%; height:100%; } 

        /* Lời chúc */
        #greeting-text {
            position: absolute; top: 60%; width: 100%; text-align: center;
            font-family: 'Great Vibes', cursive; color: #ffde59; 
            font-size: clamp(3rem, 8vw, 5rem);
            text-shadow: 0 0 20px #ff0055, 0 0 40px #ff0055;
            opacity: 0; pointer-events: none; z-index: 5;
            transition: opacity 1.5s ease-in-out;
        }

        /* Nút Bấm */
        #start-btn {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 15px 40px; background: transparent; color: #ffd700; 
            border: 2px solid #ffd700; border-radius: 30px; cursor: pointer; z-index: 1000; 
            font-weight: bold; font-size: 1.5rem; text-transform: uppercase; letter-spacing: 2px;
            box-shadow: 0 0 15px #ffd700; transition: all 0.3s;
        }
        #start-btn:hover { background: #ffd700; color: #000; box-shadow: 0 0 40px #ffd700; }

        /* LÌ XÌ STYLE */
        .lixi-item {
            position: absolute; width: 45px; height: 75px; 
            background: linear-gradient(135deg, #e60000, #ff3333);
            border: 2px solid #ffd700; border-radius: 6px; 
            cursor: pointer; pointer-events: auto;
            display: flex; justify-content: center; align-items: center; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); top: -100px;
        }
        .lixi-item::after { 
            content: 'TẾT'; font-size: 18px; color: #ffd700; 
            font-family: 'Montserrat', sans-serif; font-weight: 900;
            border: 2px solid gold; padding: 5px 2px; border-radius: 50%;
        }
        .lixi-item:hover { transform: scale(1.15) rotate(5deg); z-index: 100; box-shadow: 0 0 25px gold; }
        .lixi-item.opened { filter: grayscale(0.8); opacity: 0.6; }

        /* MODAL */
        #modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9);
            z-index: 3000; display: none; justify-content: center; align-items: center; flex-direction: column;
        }
        #modal-box { 
            background: #fff; padding: 25px; border-radius: 12px; text-align: center; 
            max-width: 90%; border: 3px solid #d90000; animation: popIn 0.3s ease-out;
        }
        @keyframes popIn { from{transform:scale(0.8);opacity:0} to{transform:scale(1);opacity:1} }
        #modal-img { max-width: 100%; max-height: 45vh; border-radius: 8px; margin-bottom: 15px; display: block; margin: 0 auto; border: 2px solid gold;}
        #modal-text { font-family: 'Dancing Script', cursive; font-size: 1.8rem; color: #d90000; }
        
        /* ẢNH PHÁO HOA NỔ RA */
        .firework-img {
            position: absolute; width: 0; border-radius: 50%; border: 3px solid gold;
            transform: translate(-50%, -50%); pointer-events: none; z-index: 8;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }
    </style>
</head>
<body>

    <button id="start-btn">Khai Xuân 2026</button>
    <div id="greeting-text">Chúc Mừng Năm Mới</div>

    <canvas id="fw-canvas"></canvas>
    <canvas id="text-canvas"></canvas>
    <canvas id="blossom-canvas"></canvas>
    <canvas id="tree-canvas"></canvas>
    
    <div id="items-layer"></div>

    <div id="modal" onclick="this.style.display='none'">
        <div id="modal-box">
            <img id="modal-img" src="">
            <div id="modal-text"></div>
        </div>
        <p style="color: #888; margin-top: 15px; font-size: 13px;">(Chạm bất kỳ đâu để đóng)</p>
    </div>

    <script>
        const isMobile=/Mobi|Android/i.test(navigator.userAgent);
        const IMAGE_COUNT = 10;
function getRandomImage() {
    const n = Math.floor(Math.random() * IMAGE_COUNT) + 1;
    return `img/${n}.jpg`;
}

        const WISHES = [
            "Vạn sự như ý - Tỷ sự như mơ",
            "Tiền vào như nước - Tiền ra nhỏ giọt",
            "Gia đình hạnh phúc - Sức khỏe dồi dào",
            "Năm mới thắng lợi mới - Thành công rực rỡ",
            "Tình duyên phơi phới - Hạnh phúc ngập tràn",

            "An khang thịnh vượng - Phúc lộc đầy nhà",
            "Xuân sang phú quý - Cả năm an vui",
            "Công việc suôn sẻ - Thuận lợi hanh thông",
            "May mắn đủ đầy - Niềm vui trọn vẹn",
            "Tiền tài rộng mở - Cuộc sống thảnh thơi",

            "Tết đến bình an - Xuân sang hạnh phúc",
            "Gia đạo yên ấm - Phúc lộc song toàn",
            "Khởi đầu thuận lợi - Kết quả viên mãn",
            "Mọi điều như ý - Trăm sự hanh thông",
            "Xuân mới rực rỡ - Vạn điều tốt lành",

            "Năm mới phát tài - Lộc vào như ý",
            "Cười nhiều hơn nữa - Lo lắng ít đi",
            "Tâm an trí sáng - Vững bước thành công",
            "Sức khỏe dồi dào - Nụ cười luôn nở",
            "Niềm vui lan tỏa - Hạnh phúc đong đầy",

            "Xuân về gió mát - Lộc phát quanh năm",
            "Tết này rộn rã - Tết sau huy hoàng",
            "Gia đình sum họp - Tình thân bền lâu",
            "Học hành tấn tới - Sự nghiệp thăng hoa",
            "Lộc xuân gõ cửa - May mắn theo chân"
        ];


        const boomSound = new Audio("https://www.soundjay.com/mechanical/sounds/explosion-02.mp3");
        
        const fwCanvas = document.getElementById('fw-canvas');
        const textCanvas = document.getElementById('text-canvas');
        const treeCanvas = document.getElementById('tree-canvas');
        const blossomCanvas = document.getElementById('blossom-canvas');
        
        const fwCtx = fwCanvas.getContext('2d');
        const textCtx = textCanvas.getContext('2d');
        const treeCtx = treeCanvas.getContext('2d');
        const blossomCtx = blossomCanvas.getContext('2d');

        let width, height, particles = [], fireworks = [], branchTips = [], blossoms = [];

        function resize() {
            width = window.innerWidth; height = window.innerHeight;
            [fwCanvas, textCanvas, treeCanvas, blossomCanvas].forEach(c => { c.width = width; c.height = height; });
            drawStaticTree(); 
            initBlossoms();
        }
        window.addEventListener('resize', resize);

        // --- 1. COUNTDOWN PARTICLES ---
        class TextParticle {
    constructor() {
        this.x = Math.random()*width;
        this.y = Math.random()*height;
        this.z = Math.random()*200; // chiều sâu
        this.alpha = 0;
    }
    draw() {
        const scale = 1 + this.z / 600;
        textCtx.save();
        textCtx.globalAlpha = this.alpha;
        textCtx.fillStyle = "#ffd700";
        textCtx.shadowColor = "#ffcc00";
        textCtx.shadowBlur = 10;
        textCtx.beginPath();
        textCtx.arc(this.x, this.y, 2 * scale, 0, Math.PI*2);
        textCtx.fill();
        textCtx.restore();
    }
}

        function getPoints(text) {
            const t = document.createElement('canvas'); const c = t.getContext('2d');
            t.width=width; t.height=height; 
            c.font=`bold ${Math.min(width/4, 250)}px Montserrat`;
            c.textAlign="center"; c.textBaseline="middle"; 
            let offsetY = text === "2026" ? -80 : 0;
            c.fillText(text, width/2, height/2 + offsetY);
            const d=c.getImageData(0,0,width,height).data, pts=[];
            for(let y=0;y<height;y+=6)for(let x=0;x<width;x+=6)if(d[(y*width+x)*4+3]>128)pts.push({x,y});
            return pts;
        }

        // --- 2. FIREWORKS (CIRCULAR EXPLOSION - STANDARD) ---
        class Firework {
            constructor() {
                this.x = Math.random() * width; this.y = height;
                this.tx = this.x; this.ty = Math.random() * height * 0.4;
                this.color = `hsl(${Math.random()*360}, 100%, 60%)`;
                this.exploded = false; this.sparks = [];
                this.hasPhoto = Math.random() < 0.3; // 30% tỷ lệ nổ ra ảnh
            }
            update() {
                if(!this.exploded) {
                    this.y -= 5; 
                    if(this.y <= this.ty) this.explode();
                } else {
                    this.sparks.forEach((s, i) => {
                        s.x += s.vx; 
                        s.y += s.vy; 
                        s.vx *= 0.95; // Ma sát không khí (friction)
                        s.vy *= 0.95;
                        s.vy += 0.15; // Trọng lực (gravity)
                        s.alpha -= 0.015; // Mờ dần
                        if(s.alpha <= 0) this.sparks.splice(i, 1);
                    });
                }
            }
            explode() {
                this.exploded = true;
                const s = boomSound.cloneNode(); s.volume = 0.25; s.play().catch(()=>{});
                
                if(this.hasPhoto) showPhoto(this.x, this.y);

                // Nổ tròn (Circular Pattern)
                const particleCount = 100;
                for(let i=0; i<particleCount; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    // Tốc độ ngẫu nhiên để tạo độ sâu
                    const speed = Math.random() * 5 + 2; 
                    this.sparks.push({
                        x: this.x, 
                        y: this.y, 
                        vx: Math.cos(angle) * speed, 
                        vy: Math.sin(angle) * speed, 
                        color: this.color, 
                        alpha: 1
                    });
                }
            }
            draw() {
                if(!this.exploded) { 
                    fwCtx.fillStyle = this.color; 
                    fwCtx.fillRect(this.x, this.y, 3, 8); // Đuôi pháo bay lên
                } else { 
                    this.sparks.forEach(s => { 
                        fwCtx.globalAlpha = s.alpha; 
                        fwCtx.fillStyle = s.color; 
                        fwCtx.beginPath(); 
                        fwCtx.arc(s.x, s.y, 1.8, 0, Math.PI*2); 
                        fwCtx.fill(); 
                    }); 
                }
            }
        }

        function showPhoto(x, y) {
            const img = document.createElement('img');
            img.src = getRandomImage();
            img.className = 'firework-img';
            img.style.left = x + 'px';
            img.style.top = y + 'px';
            document.body.appendChild(img);
            
            gsap.to(img, {
                width: 150, 
                opacity: 0, 
                rotation: 360,
                duration: 1.5, 
                ease: "power2.out",
                onComplete: () => img.remove()
            });
        }

        // --- 3. HOA MAI BAY ---
        class ApricotBlossom {
            constructor() { this.reset(); this.y = Math.random()*height; }
            reset() { this.x=Math.random()*width; this.y=-20; this.size=Math.random()*5+5; this.sY=Math.random()*0.5+0.5; this.a=Math.random()*Math.PI*2; }
            update() { this.y+=this.sY; if(this.y>height) this.reset(); }
            draw() {
                blossomCtx.save(); blossomCtx.translate(this.x, this.y); blossomCtx.rotate(this.a);
                blossomCtx.fillStyle = "#ffd700";
                for(let i=0; i<5; i++) { blossomCtx.beginPath(); blossomCtx.ellipse(0, -this.size/2, this.size/4, this.size/2, 0, 0, Math.PI*2); blossomCtx.fill(); blossomCtx.rotate(Math.PI*2/5); }
                blossomCtx.restore();
            }
        }
        function initBlossoms() { blossoms=[]; for(let i=0; i<40; i++) blossoms.push(new ApricotBlossom()); }

        // --- 4. CÂY ĐÀO TỰ NHIÊN ---
        function drawStaticTree() {
            treeCtx.clearRect(0,0,width,height);
            branchTips = [];
            
            function drawFlowerCloud(x, y, spread) {
                const count = 30; 
                for(let i=0; i<count; i++) {
                    const ox = (Math.random()-0.5)*spread;
                    const oy = (Math.random()-0.5)*spread;
                    const size = Math.random()*5+2;
                    treeCtx.beginPath();
                    treeCtx.fillStyle = `rgba(255, ${150+Math.random()*100}, ${180+Math.random()*50}, 0.6)`;
                    treeCtx.ellipse(x+ox, y+oy, size, size*0.8, Math.random()*Math.PI, 0, Math.PI*2);
                    treeCtx.fill();
                }
            }

            function branch(x, y, len, ang, thick) {
                const ex = x + Math.cos(ang)*len;
                const ey = y + Math.sin(ang)*len;
                
                if (thick > 2) {
                    treeCtx.beginPath();
                    treeCtx.strokeStyle = '#3d251e';
                    treeCtx.lineWidth = thick;
                    treeCtx.lineCap = 'round';
                    treeCtx.moveTo(x,y);
                    treeCtx.quadraticCurveTo(x + Math.cos(ang)*len*0.5 + (Math.random()-0.5)*15, y + Math.sin(ang)*len*0.5, ex, ey);
                    treeCtx.stroke();
                }

                if(len < 30 || thick < 4) {
                    drawFlowerCloud(ex, ey, 35);
                    if(len < 20) branchTips.push({x: ex, y: ey});
                }
                 
                if(len < 12) return;
                branch(ex, ey, len * (0.7 + Math.random()*0.15), ang + (Math.random()*0.5 + 0.2), thick * 0.65);
                branch(ex, ey, len * (0.7 + Math.random()*0.15), ang - (Math.random()*0.5 + 0.2), thick * 0.65);
            }
            branch(width/2, height + 30, 150, -Math.PI/2, 20);
        }

        // --- 5. LÌ XÌ RƠI ---
        function dropLixi() {
            const container = document.getElementById('items-layer');
            if(branchTips.length === 0) return;
            const targets = branchTips.sort(() => 0.5 - Math.random()).slice(0, 8);
            targets.forEach((target, i) => {
                const el = document.createElement('div'); el.className = 'lixi-item';
                el.style.left = target.x + 'px'; 
                el.onclick = () => {
                    document.getElementById('modal').style.display = 'flex';
                    document.getElementById('modal-img').src = getRandomImage();
                    document.getElementById('modal-text').innerText = WISHES[i % WISHES.length];
                    el.classList.add('opened');
                };
                container.appendChild(el);
                gsap.to(el, {
                    top: target.y, rotation: Math.random()*20-10, duration: 2.5 + Math.random(), ease: "bounce.out", delay: i*0.3,
                    onComplete: () => { gsap.to(el, {rotation: 5, duration: 2, yoyo: true, repeat: -1, ease: "sine.inOut"}); }
                });
            });
        }

        // --- LOOP ---
        function loop() {
            // Hiệu ứng đuôi dài (Trails)
            fwCtx.globalCompositeOperation = 'destination-out'; 
            fwCtx.fillStyle = 'rgba(0, 0, 0, 0.1)'; 
            fwCtx.fillRect(0, 0, width, height);
            fwCtx.globalCompositeOperation = 'source-over';
            
            textCtx.clearRect(0,0,width,height);
            blossomCtx.clearRect(0,0,width,height);

            particles.forEach(p => p.draw());
            blossoms.forEach(b => { b.update(); b.draw(); });

            if(Math.random() < 0.05 && fireworks.length < 10) fireworks.push(new Firework());
            fireworks.forEach((f, i) => { f.update(); f.draw(); if(f.exploded && f.sparks.length === 0) fireworks.splice(i, 1); });
            
            requestAnimationFrame(loop);
        }

        // --- SEQUENCE ---
        document.getElementById('start-btn').onclick = async function() {
            this.style.display = 'none'; 
            resize(); 
            loop();
            
            const seq = ["3", "2", "1", "2026"];
            for(let txt of seq) {
                const pts = getPoints(txt);
                if(particles.length < pts.length) for(let i=particles.length; i<pts.length; i++) particles.push(new TextParticle());
                gsap.to(particles.slice(0, pts.length), {x: i => pts[i].x, y: i => pts[i].y, alpha: 1, duration: 0.8, ease: "power2.inOut"});
                
                if (txt === "2026") {
                    document.getElementById('greeting-text').style.opacity = 1;
                    
                    await new Promise(r => setTimeout(r, 3000));

                    gsap.to(particles, {alpha: 0, duration: 1.5});
                    document.getElementById('greeting-text').style.opacity = 0;

                    setTimeout(() => {
                        document.getElementById('tree-canvas').style.opacity = 1;
                        document.getElementById('blossom-canvas').style.opacity = 1; 
                        setTimeout(dropLixi, 1000);
                    }, 1000);

                } else {
                    await new Promise(r => setTimeout(r, 1000));
                    gsap.to(particles, {alpha: 0, duration: 0.2});
                }
            }
        };
    </script>
</body>
</html>